{"ast":null,"code":"import { debounce, isNullOrUndefined, detach } from '@syncfusion/ej2-base';\nimport { NodeSelection } from './../../selection/selection';\nimport * as EVENTS from './../../common/constant';\nimport { isIDevice, setEditFrameFocus } from '../../common/util';\n/**\n * `Undo` module is used to handle undo actions.\n */\n\nvar UndoRedoManager =\n/** @class */\nfunction () {\n  function UndoRedoManager(parent, options) {\n    this.undoRedoStack = [];\n    this.parent = parent;\n    this.undoRedoSteps = !isNullOrUndefined(options) ? options.undoRedoSteps : 30;\n    this.undoRedoTimer = !isNullOrUndefined(options) ? options.undoRedoTimer : 300;\n    this.addEventListener();\n  }\n\n  UndoRedoManager.prototype.addEventListener = function () {\n    var debounceListener = debounce(this.keyUp, this.undoRedoTimer);\n    this.parent.observer.on(EVENTS.KEY_UP_HANDLER, debounceListener, this);\n    this.parent.observer.on(EVENTS.KEY_DOWN_HANDLER, this.keyDown, this);\n    this.parent.observer.on(EVENTS.ACTION, this.onAction, this);\n    this.parent.observer.on(EVENTS.MODEL_CHANGED_PLUGIN, this.onPropertyChanged, this);\n  };\n\n  UndoRedoManager.prototype.onPropertyChanged = function (props) {\n    for (var _i = 0, _a = Object.keys(props.newProp); _i < _a.length; _i++) {\n      var prop = _a[_i];\n\n      switch (prop) {\n        case 'undoRedoSteps':\n          this.undoRedoSteps = props.newProp.undoRedoSteps;\n          break;\n\n        case 'undoRedoTimer':\n          this.undoRedoTimer = props.newProp.undoRedoTimer;\n          break;\n      }\n    }\n  };\n\n  UndoRedoManager.prototype.removeEventListener = function () {\n    this.parent.observer.off(EVENTS.KEY_UP_HANDLER, this.keyUp);\n    this.parent.observer.off(EVENTS.KEY_DOWN_HANDLER, this.keyDown);\n    this.parent.observer.off(EVENTS.ACTION, this.onAction);\n  };\n  /**\n   * onAction method\n   *\n   * @param {IHtmlSubCommands} e - specifies the sub command\n   * @returns {void}\n   * @hidden\n    */\n\n\n  UndoRedoManager.prototype.onAction = function (e) {\n    if (e.subCommand === 'Undo') {\n      this.undo(e);\n    } else {\n      this.redo(e);\n    }\n  };\n  /**\n   * Destroys the ToolBar.\n   *\n   * @function destroy\n   * @returns {void}\n   * @hidden\n    */\n\n\n  UndoRedoManager.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n\n  UndoRedoManager.prototype.keyDown = function (e) {\n    var event = e.event; // eslint-disable-next-line\n\n    var proxy = this;\n\n    switch (event.action) {\n      case 'undo':\n        event.preventDefault();\n        proxy.undo(e);\n        break;\n\n      case 'redo':\n        event.preventDefault();\n        proxy.redo(e);\n        break;\n    }\n  };\n\n  UndoRedoManager.prototype.keyUp = function (e) {\n    if (e.event.keyCode !== 17 && !e.event.ctrlKey) {\n      this.saveData(e);\n    }\n  };\n  /**\n   * RTE collection stored html format.\n   *\n   * @function saveData\n   * @param {KeyboardEvent} e - specifies the keyboard event\n   * @returns {void}\n   * @hidden\n    */\n\n\n  UndoRedoManager.prototype.saveData = function (e) {\n    var range = new NodeSelection().getRange(this.parent.currentDocument);\n    var currentContainer = range.startContainer;\n\n    for (var i = currentContainer.childNodes.length - 1; i >= 0; i--) {\n      if (!isNullOrUndefined(currentContainer.childNodes[i]) && currentContainer.childNodes[i].nodeName === '#text' && currentContainer.childNodes[i].textContent.length === 0 && currentContainer.childNodes[i].nodeName !== 'IMG' && currentContainer.childNodes[i].nodeName !== 'BR' && currentContainer.childNodes[i].nodeName && 'HR') {\n        detach(currentContainer.childNodes[i]);\n      }\n    }\n\n    range = new NodeSelection().getRange(this.parent.currentDocument);\n    var save = new NodeSelection().save(range, this.parent.currentDocument);\n    var htmlText = this.parent.editableElement.innerHTML;\n    var changEle = {\n      text: htmlText,\n      range: save\n    };\n\n    if (this.undoRedoStack.length >= this.steps) {\n      this.undoRedoStack = this.undoRedoStack.slice(0, this.steps + 1);\n    }\n\n    if (this.undoRedoStack.length > 1 && this.undoRedoStack[this.undoRedoStack.length - 1].range.range.collapsed === range.collapsed && this.undoRedoStack[this.undoRedoStack.length - 1].range.startOffset === save.range.startOffset && this.undoRedoStack[this.undoRedoStack.length - 1].range.endOffset === save.range.endOffset && this.undoRedoStack[this.undoRedoStack.length - 1].range.range.startContainer === save.range.startContainer && this.undoRedoStack[this.undoRedoStack.length - 1].text.trim() === changEle.text.trim()) {\n      return;\n    }\n\n    this.undoRedoStack.push(changEle);\n    this.steps = this.undoRedoStack.length - 1;\n\n    if (this.steps > this.undoRedoSteps) {\n      this.undoRedoStack.shift();\n      this.steps--;\n    }\n\n    if (e && e.callBack) {\n      e.callBack();\n    }\n  };\n  /**\n   * Undo the editable text.\n   *\n   * @function undo\n   * @param {IHtmlSubCommands} e - specifies the sub commands\n   * @returns {void}\n   * @hidden\n    */\n\n\n  UndoRedoManager.prototype.undo = function (e) {\n    if (this.steps > 0) {\n      var range = this.undoRedoStack[this.steps - 1].range;\n      var removedContent = this.undoRedoStack[this.steps - 1].text;\n      this.parent.editableElement.innerHTML = removedContent;\n      this.parent.editableElement.focus();\n\n      if (isIDevice()) {\n        setEditFrameFocus(this.parent.editableElement, e.selector);\n      }\n\n      range.restore();\n      this.steps--;\n\n      if (e.callBack) {\n        e.callBack({\n          requestType: 'Undo',\n          editorMode: 'HTML',\n          range: range,\n          elements: this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),\n          event: e.event\n        });\n      }\n    }\n  };\n  /**\n   * Redo the editable text.\n   *\n   * @param {IHtmlSubCommands} e - specifies the sub commands\n   * @function redo\n   * @returns {void}\n   * @hidden\n    */\n\n\n  UndoRedoManager.prototype.redo = function (e) {\n    if (this.undoRedoStack[this.steps + 1] != null) {\n      var range = this.undoRedoStack[this.steps + 1].range;\n      this.parent.editableElement.innerHTML = this.undoRedoStack[this.steps + 1].text;\n      this.parent.editableElement.focus();\n\n      if (isIDevice()) {\n        setEditFrameFocus(this.parent.editableElement, e.selector);\n      }\n\n      range.restore();\n      this.steps++;\n\n      if (e.callBack) {\n        e.callBack({\n          requestType: 'Redo',\n          editorMode: 'HTML',\n          range: range,\n          elements: this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),\n          event: e.event\n        });\n      }\n    }\n  };\n  /**\n   * getUndoStatus method\n   *\n   * @returns {boolean} - returns the boolean value\n   * @hidden\n    */\n\n\n  UndoRedoManager.prototype.getUndoStatus = function () {\n    var status = {\n      undo: false,\n      redo: false\n    };\n\n    if (this.steps > 0) {\n      status.undo = true;\n    }\n\n    if (this.undoRedoStack[this.steps + 1] != null) {\n      status.redo = true;\n    }\n\n    return status;\n  };\n\n  return UndoRedoManager;\n}();\n\nexport { UndoRedoManager };","map":{"version":3,"sources":["/Users/altynbekkuat/Desktop/NomaLytics/node_modules/@syncfusion/ej2-react-richtexteditor/node_modules/@syncfusion/ej2-richtexteditor/src/editor-manager/plugin/undo.js"],"names":["debounce","isNullOrUndefined","detach","NodeSelection","EVENTS","isIDevice","setEditFrameFocus","UndoRedoManager","parent","options","undoRedoStack","undoRedoSteps","undoRedoTimer","addEventListener","prototype","debounceListener","keyUp","observer","on","KEY_UP_HANDLER","KEY_DOWN_HANDLER","keyDown","ACTION","onAction","MODEL_CHANGED_PLUGIN","onPropertyChanged","props","_i","_a","Object","keys","newProp","length","prop","removeEventListener","off","e","subCommand","undo","redo","destroy","event","proxy","action","preventDefault","keyCode","ctrlKey","saveData","range","getRange","currentDocument","currentContainer","startContainer","i","childNodes","nodeName","textContent","save","htmlText","editableElement","innerHTML","changEle","text","steps","slice","collapsed","startOffset","endOffset","trim","push","shift","callBack","removedContent","focus","selector","restore","requestType","editorMode","elements","nodeSelection","getSelectedNodes","getUndoStatus","status"],"mappings":"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","sourcesContent":["import { debounce, isNullOrUndefined, detach } from '@syncfusion/ej2-base';\nimport { NodeSelection } from './../../selection/selection';\nimport * as EVENTS from './../../common/constant';\nimport { isIDevice, setEditFrameFocus } from '../../common/util';\n/**\n * `Undo` module is used to handle undo actions.\n */\nvar UndoRedoManager = /** @class */ (function () {\n    function UndoRedoManager(parent, options) {\n        this.undoRedoStack = [];\n        this.parent = parent;\n        this.undoRedoSteps = !isNullOrUndefined(options) ? options.undoRedoSteps : 30;\n        this.undoRedoTimer = !isNullOrUndefined(options) ? options.undoRedoTimer : 300;\n        this.addEventListener();\n    }\n    UndoRedoManager.prototype.addEventListener = function () {\n        var debounceListener = debounce(this.keyUp, this.undoRedoTimer);\n        this.parent.observer.on(EVENTS.KEY_UP_HANDLER, debounceListener, this);\n        this.parent.observer.on(EVENTS.KEY_DOWN_HANDLER, this.keyDown, this);\n        this.parent.observer.on(EVENTS.ACTION, this.onAction, this);\n        this.parent.observer.on(EVENTS.MODEL_CHANGED_PLUGIN, this.onPropertyChanged, this);\n    };\n    UndoRedoManager.prototype.onPropertyChanged = function (props) {\n        for (var _i = 0, _a = Object.keys(props.newProp); _i < _a.length; _i++) {\n            var prop = _a[_i];\n            switch (prop) {\n                case 'undoRedoSteps':\n                    this.undoRedoSteps = props.newProp.undoRedoSteps;\n                    break;\n                case 'undoRedoTimer':\n                    this.undoRedoTimer = props.newProp.undoRedoTimer;\n                    break;\n            }\n        }\n    };\n    UndoRedoManager.prototype.removeEventListener = function () {\n        this.parent.observer.off(EVENTS.KEY_UP_HANDLER, this.keyUp);\n        this.parent.observer.off(EVENTS.KEY_DOWN_HANDLER, this.keyDown);\n        this.parent.observer.off(EVENTS.ACTION, this.onAction);\n    };\n    /**\n     * onAction method\n     *\n     * @param {IHtmlSubCommands} e - specifies the sub command\n     * @returns {void}\n     * @hidden\n\n     */\n    UndoRedoManager.prototype.onAction = function (e) {\n        if (e.subCommand === 'Undo') {\n            this.undo(e);\n        }\n        else {\n            this.redo(e);\n        }\n    };\n    /**\n     * Destroys the ToolBar.\n     *\n     * @function destroy\n     * @returns {void}\n     * @hidden\n\n     */\n    UndoRedoManager.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    UndoRedoManager.prototype.keyDown = function (e) {\n        var event = e.event;\n        // eslint-disable-next-line\n        var proxy = this;\n        switch (event.action) {\n            case 'undo':\n                event.preventDefault();\n                proxy.undo(e);\n                break;\n            case 'redo':\n                event.preventDefault();\n                proxy.redo(e);\n                break;\n        }\n    };\n    UndoRedoManager.prototype.keyUp = function (e) {\n        if (e.event.keyCode !== 17 && !e.event.ctrlKey) {\n            this.saveData(e);\n        }\n    };\n    /**\n     * RTE collection stored html format.\n     *\n     * @function saveData\n     * @param {KeyboardEvent} e - specifies the keyboard event\n     * @returns {void}\n     * @hidden\n\n     */\n    UndoRedoManager.prototype.saveData = function (e) {\n        var range = new NodeSelection().getRange(this.parent.currentDocument);\n        var currentContainer = range.startContainer;\n        for (var i = currentContainer.childNodes.length - 1; i >= 0; i--) {\n            if (!isNullOrUndefined(currentContainer.childNodes[i]) && currentContainer.childNodes[i].nodeName === '#text' &&\n                currentContainer.childNodes[i].textContent.length === 0 && currentContainer.childNodes[i].nodeName !== 'IMG' &&\n                currentContainer.childNodes[i].nodeName !== 'BR' && currentContainer.childNodes[i].nodeName && 'HR') {\n                detach(currentContainer.childNodes[i]);\n            }\n        }\n        range = new NodeSelection().getRange(this.parent.currentDocument);\n        var save = new NodeSelection().save(range, this.parent.currentDocument);\n        var htmlText = this.parent.editableElement.innerHTML;\n        var changEle = { text: htmlText, range: save };\n        if (this.undoRedoStack.length >= this.steps) {\n            this.undoRedoStack = this.undoRedoStack.slice(0, this.steps + 1);\n        }\n        if (this.undoRedoStack.length > 1 && (this.undoRedoStack[this.undoRedoStack.length - 1].range.range.collapsed === range.collapsed)\n            && (this.undoRedoStack[this.undoRedoStack.length - 1].range.startOffset === save.range.startOffset) &&\n            (this.undoRedoStack[this.undoRedoStack.length - 1].range.endOffset === save.range.endOffset) &&\n            (this.undoRedoStack[this.undoRedoStack.length - 1].range.range.startContainer === save.range.startContainer) &&\n            (this.undoRedoStack[this.undoRedoStack.length - 1].text.trim() === changEle.text.trim())) {\n            return;\n        }\n        this.undoRedoStack.push(changEle);\n        this.steps = this.undoRedoStack.length - 1;\n        if (this.steps > this.undoRedoSteps) {\n            this.undoRedoStack.shift();\n            this.steps--;\n        }\n        if (e && e.callBack) {\n            e.callBack();\n        }\n    };\n    /**\n     * Undo the editable text.\n     *\n     * @function undo\n     * @param {IHtmlSubCommands} e - specifies the sub commands\n     * @returns {void}\n     * @hidden\n\n     */\n    UndoRedoManager.prototype.undo = function (e) {\n        if (this.steps > 0) {\n            var range = this.undoRedoStack[this.steps - 1].range;\n            var removedContent = this.undoRedoStack[this.steps - 1].text;\n            this.parent.editableElement.innerHTML = removedContent;\n            this.parent.editableElement.focus();\n            if (isIDevice()) {\n                setEditFrameFocus(this.parent.editableElement, e.selector);\n            }\n            range.restore();\n            this.steps--;\n            if (e.callBack) {\n                e.callBack({\n                    requestType: 'Undo',\n                    editorMode: 'HTML',\n                    range: range,\n                    elements: this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),\n                    event: e.event\n                });\n            }\n        }\n    };\n    /**\n     * Redo the editable text.\n     *\n     * @param {IHtmlSubCommands} e - specifies the sub commands\n     * @function redo\n     * @returns {void}\n     * @hidden\n\n     */\n    UndoRedoManager.prototype.redo = function (e) {\n        if (this.undoRedoStack[this.steps + 1] != null) {\n            var range = this.undoRedoStack[this.steps + 1].range;\n            this.parent.editableElement.innerHTML = this.undoRedoStack[this.steps + 1].text;\n            this.parent.editableElement.focus();\n            if (isIDevice()) {\n                setEditFrameFocus(this.parent.editableElement, e.selector);\n            }\n            range.restore();\n            this.steps++;\n            if (e.callBack) {\n                e.callBack({\n                    requestType: 'Redo',\n                    editorMode: 'HTML',\n                    range: range,\n                    elements: this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),\n                    event: e.event\n                });\n            }\n        }\n    };\n    /**\n     * getUndoStatus method\n     *\n     * @returns {boolean} - returns the boolean value\n     * @hidden\n\n     */\n    UndoRedoManager.prototype.getUndoStatus = function () {\n        var status = { undo: false, redo: false };\n        if (this.steps > 0) {\n            status.undo = true;\n        }\n        if (this.undoRedoStack[this.steps + 1] != null) {\n            status.redo = true;\n        }\n        return status;\n    };\n    return UndoRedoManager;\n}());\nexport { UndoRedoManager };\n"]},"metadata":{},"sourceType":"module"}