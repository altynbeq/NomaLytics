{"ast":null,"code":"import { isNullOrUndefined as isNOU, detach } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\n/**\n * `EnterKey` module is used to handle enter key press actions.\n */\n\nvar EnterKeyAction =\n/** @class */\nfunction () {\n  function EnterKeyAction(parent) {\n    this.parent = parent;\n    this.addEventListener();\n  }\n\n  EnterKeyAction.prototype.addEventListener = function () {\n    this.parent.on(events.enterHandler, this.enterHandler, this);\n    this.parent.on(events.destroy, this.destroy, this);\n  };\n\n  EnterKeyAction.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n\n  EnterKeyAction.prototype.removeEventListener = function () {\n    this.parent.off(events.enterHandler, this.enterHandler);\n    this.parent.off(events.destroy, this.destroy);\n  };\n\n  EnterKeyAction.prototype.getRangeNode = function () {\n    this.range = this.parent.getRange();\n    this.startNode = this.range.startContainer.nodeName === '#text' ? this.range.startContainer.parentElement : this.range.startContainer;\n    this.endNode = this.range.endContainer.nodeName === '#text' ? this.range.endContainer.parentElement : this.range.endContainer;\n  };\n\n  EnterKeyAction.prototype.enterHandler = function (e) {\n    var _this = this;\n\n    this.getRangeNode();\n    var isTableEnter = true;\n\n    if (!isNOU(this.startNode.closest('TABLE')) && !isNOU(this.endNode.closest('TABLE'))) {\n      isTableEnter = false;\n      var curElement = this.startNode;\n      var blockElement = curElement;\n\n      while (!this.parent.formatter.editorManager.domNode.isBlockNode(curElement)) {\n        blockElement = curElement;\n        curElement = curElement.parentElement;\n      }\n\n      isTableEnter = blockElement.tagName === 'TD' ? false : true;\n    }\n\n    if (e.args.which === 13 && e.args.code === 'Enter') {\n      if (isNOU(this.startNode.closest('LI')) && isNOU(this.endNode.closest('LI')) && isTableEnter && isNOU(this.startNode.closest('PRE')) && isNOU(this.endNode.closest('PRE'))) {\n        var shiftKey_1 = e.args.shiftKey;\n        var actionBeginArgs = {\n          cancel: false,\n          name: events.actionBegin,\n          requestType: shiftKey_1 ? 'ShiftEnterAction' : 'EnterAction',\n          originalEvent: e.args\n        };\n        this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n          if (!actionBeginArgs.cancel) {\n            if (!(_this.range.startOffset === _this.range.endOffset && _this.range.startContainer === _this.range.endContainer)) {\n              _this.range.deleteContents();\n\n              if (_this.range.startContainer.nodeName === '#text' && _this.range.startContainer.textContent.length === 0 && _this.range.startContainer.parentElement !== _this.parent.inputElement) {\n                if (_this.parent.enterKey === 'BR') {\n                  _this.range.startContainer.parentElement.innerHTML = '&#8203;';\n                } else {\n                  _this.range.startContainer.parentElement.innerHTML = '<br>';\n                }\n              } else if (_this.range.startContainer === _this.parent.inputElement && _this.range.startContainer.innerHTML === '') {\n                _this.range.startContainer.innerHTML = '<br>';\n                var focusElem = _this.range.startContainer.childNodes[_this.range.startOffset];\n\n                _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), focusElem, 0);\n              } else if (_this.parent.inputElement === _this.range.startContainer) {\n                var focusElem = _this.range.startContainer.childNodes[_this.range.startOffset];\n\n                if (focusElem.nodeName === '#text' && focusElem.textContent.length === 0) {\n                  _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), focusElem, focusElem.previousSibling.textContent.length);\n                } else {\n                  _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), focusElem, focusElem.textContent.length >= 0 ? 0 : 1);\n\n                  if (focusElem.previousSibling.textContent.length === 0) {\n                    detach(focusElem.previousSibling);\n                  } else if (focusElem.textContent.length === 0) {\n                    var currentFocusElem = focusElem.previousSibling.lastChild;\n\n                    while (currentFocusElem.nodeName !== '#text') {\n                      currentFocusElem = currentFocusElem.lastChild;\n                    }\n\n                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), currentFocusElem, currentFocusElem.textContent.length);\n\n                    detach(focusElem);\n                  } else if (_this.parent.enterKey !== 'BR' && focusElem.previousSibling.textContent.length !== 0 && focusElem.textContent.length !== 0) {\n                    e.args.preventDefault();\n                    return;\n                  }\n                }\n\n                _this.getRangeNode();\n              }\n            }\n\n            if (_this.range.startContainer === _this.range.endContainer && _this.range.startOffset === _this.range.endOffset && _this.range.startContainer === _this.parent.inputElement) {\n              _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), _this.range.startContainer.childNodes[_this.range.startOffset], 0);\n\n              _this.getRangeNode();\n            }\n\n            if (_this.parent.enterKey === 'P' && !shiftKey_1 || _this.parent.enterKey === 'DIV' && !shiftKey_1 || _this.parent.shiftEnterKey === 'P' && shiftKey_1 || _this.parent.shiftEnterKey === 'DIV' && shiftKey_1) {\n              var nearBlockNode = void 0;\n\n              if (isTableEnter && _this.parent.formatter.editorManager.domNode.isBlockNode(_this.startNode)) {\n                nearBlockNode = _this.startNode;\n              } else {\n                nearBlockNode = _this.parent.formatter.editorManager.domNode.blockParentNode(_this.startNode);\n              }\n\n              var isImageNode = false;\n              var isFocusedFirst = false;\n\n              if (_this.range.startOffset != 0 && _this.range.endOffset != 0 && _this.range.startContainer === _this.range.endContainer && !(!isNOU(nearBlockNode.childNodes[0]) && nearBlockNode.childNodes[0].nodeName === 'IMG')) {\n                var startNodeText = _this.range.startContainer.textContent;\n                var splitFirstText = startNodeText.substring(0, _this.range.startOffset);\n\n                if (splitFirstText.charCodeAt(_this.range.startOffset - 1) != 160 && splitFirstText.trim().length === 0) {\n                  isFocusedFirst = true;\n                }\n              } else if (_this.range.startOffset === 0 && _this.range.endOffset === 0) {\n                isFocusedFirst = true;\n              }\n\n              if ((_this.range.startOffset === 0 && _this.range.endOffset === 0 || isFocusedFirst) && !(!isNOU(_this.range.startContainer.previousSibling) && (_this.range.startContainer.previousSibling.nodeName === 'IMG' || _this.range.startContainer.previousSibling.nodeName === 'BR'))) {\n                var isNearBlockLengthZero = void 0;\n                var newElem = void 0;\n\n                if (_this.range.startContainer.nodeName === 'IMG') {\n                  newElem = _this.createInsertElement(shiftKey_1);\n                  isImageNode = true;\n                  isNearBlockLengthZero = false;\n                } else {\n                  if (nearBlockNode.textContent.trim().length !== 0) {\n                    newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, false).cloneNode(true);\n                    isNearBlockLengthZero = false;\n                  } else {\n                    newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, true).cloneNode(true);\n                    isNearBlockLengthZero = true;\n                  }\n                }\n\n                var insertElem = _this.createInsertElement(shiftKey_1);\n\n                while (newElem.firstChild) {\n                  insertElem.appendChild(newElem.firstChild);\n                }\n\n                nearBlockNode.parentElement.insertBefore(insertElem, nearBlockNode);\n\n                if (!isNearBlockLengthZero) {\n                  var currentFocusElem = insertElem;\n                  var finalFocusElem = void 0;\n\n                  while (!isNOU(currentFocusElem) && currentFocusElem.nodeName !== '#text') {\n                    finalFocusElem = currentFocusElem;\n                    currentFocusElem = currentFocusElem.lastChild;\n                  }\n\n                  finalFocusElem.innerHTML = '<br>';\n\n                  if (!isImageNode) {\n                    detach(nearBlockNode);\n                  }\n                }\n\n                _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), insertElem.nextElementSibling, 0);\n              } else if (nearBlockNode.textContent.length === 0 && !(!isNOU(nearBlockNode.childNodes[0]) && nearBlockNode.childNodes[0].nodeName === 'IMG')) {\n                if (!isNOU(nearBlockNode.children[0]) && nearBlockNode.children[0].tagName !== 'BR') {\n                  var newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, false).cloneNode(true);\n\n                  _this.parent.formatter.editorManager.domNode.insertAfter(newElem, nearBlockNode);\n\n                  _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), newElem, newElem.textContent.length >= 0 ? 0 : 1);\n                } else {\n                  var insertElem = _this.createInsertElement(shiftKey_1);\n\n                  insertElem.innerHTML = '<br>';\n\n                  _this.parent.formatter.editorManager.domNode.insertAfter(insertElem, nearBlockNode);\n\n                  _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), insertElem, 0);\n                }\n              } else {\n                var newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, true);\n\n                if (!isNOU(newElem.childNodes[0]) && newElem.childNodes[0].nodeName === '#text' && newElem.childNodes[0].textContent.length === 0) {\n                  detach(newElem.childNodes[0]);\n                }\n\n                if (newElem.textContent.trim().length === 0) {\n                  var brElm = _this.parent.createElement('br');\n\n                  if (_this.startNode.nodeName === 'A') {\n                    var startParentElem = _this.startNode.parentElement;\n\n                    _this.startNode.parentElement.insertBefore(brElm, _this.startNode);\n\n                    detach(_this.startNode);\n                    _this.startNode = startParentElem;\n                  } else {\n                    _this.startNode.appendChild(brElm);\n                  }\n\n                  if (newElem.childNodes[0].textContent === '\\n') {\n                    detach(newElem.childNodes[0]);\n                  }\n\n                  _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), _this.startNode, 0);\n                }\n\n                if ((_this.parent.enterKey === 'P' || _this.parent.enterKey === 'DIV') && !shiftKey_1 || (_this.parent.shiftEnterKey === 'DIV' || _this.parent.shiftEnterKey === 'P') && shiftKey_1) {\n                  var insertElm = _this.createInsertElement(shiftKey_1);\n\n                  while (newElem.firstChild) {\n                    insertElm.appendChild(newElem.firstChild);\n                  }\n\n                  _this.parent.formatter.editorManager.domNode.insertAfter(insertElm, newElem);\n\n                  detach(newElem);\n\n                  _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), _this.parent.formatter.editorManager.domNode.isBlockNode(_this.startNode) ? insertElm : _this.startNode, 0);\n                }\n              }\n\n              e.args.preventDefault();\n            }\n\n            if (_this.parent.enterKey === 'BR' && !shiftKey_1 || _this.parent.shiftEnterKey === 'BR' && shiftKey_1) {\n              var currentParent = void 0;\n\n              if (!_this.parent.formatter.editorManager.domNode.isBlockNode(_this.startNode)) {\n                var currentNode = _this.startNode;\n                var previousNode = currentNode;\n\n                while (!_this.parent.formatter.editorManager.domNode.isBlockNode(currentNode)) {\n                  previousNode = currentNode;\n                  currentNode = currentNode.parentElement;\n                }\n\n                currentParent = currentNode === _this.parent.inputElement ? previousNode : currentNode;\n              } else {\n                currentParent = _this.startNode;\n              }\n\n              var isEmptyBrInserted = false;\n              var currentParentLastChild = currentParent.lastChild;\n\n              while (!isNOU(currentParentLastChild) && !(currentParentLastChild.nodeName === '#text' || currentParentLastChild.nodeName === 'BR')) {\n                currentParentLastChild = currentParentLastChild.lastChild;\n              }\n\n              var isLastNodeLength = _this.range.startContainer === currentParentLastChild ? _this.range.startContainer.textContent.length : currentParent.textContent.length;\n\n              if (currentParent !== _this.parent.inputElement && _this.parent.formatter.editorManager.domNode.isBlockNode(currentParent) && _this.range.startOffset === _this.range.endOffset && _this.range.startOffset === isLastNodeLength) {\n                var focusBRElem = _this.parent.createElement('br');\n\n                if (currentParentLastChild.nodeName === 'BR' && currentParent.textContent.length === 0) {\n                  _this.parent.formatter.editorManager.domNode.insertAfter(focusBRElem, currentParentLastChild);\n                } else {\n                  var lineBreakBRElem = _this.parent.createElement('br');\n\n                  _this.parent.formatter.editorManager.domNode.insertAfter(focusBRElem, _this.range.startContainer);\n\n                  _this.parent.formatter.editorManager.domNode.insertAfter(lineBreakBRElem, _this.range.startContainer);\n                }\n\n                _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), focusBRElem, 0);\n              } else if (!isNOU(currentParent) && currentParent !== _this.parent.inputElement && currentParent.nodeName !== 'BR') {\n                if (currentParent.textContent.trim().length === 0 || currentParent.textContent.trim().length === 1 && currentParent.textContent.charCodeAt(0) === 8203) {\n                  var newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, currentParent, true).cloneNode(true);\n\n                  _this.parent.formatter.editorManager.domNode.insertAfter(newElem, currentParent);\n\n                  var outerBRElem = _this.parent.createElement('br');\n\n                  newElem.parentElement.insertBefore(outerBRElem, newElem);\n\n                  _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), newElem, 0);\n                } else {\n                  var newElem = void 0;\n\n                  var outerBRElem = _this.parent.createElement('br');\n\n                  if (_this.range.startOffset === 0 && _this.range.endOffset === 0 && !isNOU(currentParent.previousSibling) && currentParent.previousSibling.nodeName === 'BR') {\n                    newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, currentParent, false).cloneNode(true);\n\n                    _this.parent.formatter.editorManager.domNode.insertAfter(outerBRElem, currentParent);\n\n                    _this.insertFocusContent();\n\n                    var currentFocusElem = outerBRElem.nextSibling;\n\n                    while (!isNOU(currentFocusElem) && currentFocusElem.nodeName !== '#text') {\n                      currentFocusElem = currentFocusElem.lastChild;\n                    }\n\n                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), currentFocusElem, 0);\n\n                    isEmptyBrInserted = true;\n                  } else {\n                    _this.insertBRElement();\n                  }\n                }\n              } else {\n                _this.insertBRElement();\n              }\n\n              e.args.preventDefault();\n            }\n\n            _this.parent.trigger(events.actionComplete, {\n              requestType: shiftKey_1 ? 'ShiftEnterAction' : 'EnterAction',\n              args: e.args\n            });\n          }\n        });\n      }\n    }\n  };\n\n  EnterKeyAction.prototype.insertBRElement = function () {\n    var isEmptyBrInserted = false;\n    var brElm = this.parent.createElement('br');\n\n    if (this.startNode.nodeName === 'BR' && this.endNode.nodeName === 'BR' && this.range.startOffset === 0 && this.range.startOffset === this.range.endOffset) {\n      this.parent.formatter.editorManager.domNode.insertAfter(brElm, this.startNode);\n      isEmptyBrInserted = true;\n    } else {\n      if (this.startNode === this.parent.inputElement && !isNOU(this.range.startContainer.previousSibling) && this.range.startContainer.previousSibling.nodeName === 'BR' && this.range.startContainer.textContent.length === 0) {\n        isEmptyBrInserted = true;\n      }\n\n      this.range.insertNode(brElm);\n    }\n\n    if (isEmptyBrInserted || !isNOU(brElm.nextElementSibling) && brElm.nextElementSibling.tagName === 'BR' || !isNOU(brElm.nextSibling) && brElm.nextSibling.textContent.length > 0) {\n      this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), !isNOU(brElm.nextSibling) ? brElm.nextSibling : brElm, 0);\n      isEmptyBrInserted = false;\n    } else {\n      var brElm2 = this.parent.createElement('br');\n      this.range.insertNode(brElm2);\n      this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), brElm, 0);\n    }\n  };\n\n  EnterKeyAction.prototype.insertFocusContent = function () {\n    if (this.range.startContainer.textContent.length === 0) {\n      if (this.range.startContainer.nodeName === '#text') {\n        this.range.startContainer.parentElement.innerHTML = '&#8203;';\n      } else {\n        this.range.startContainer.innerHTML = '&#8203;';\n      }\n    }\n  };\n\n  EnterKeyAction.prototype.createInsertElement = function (shiftKey) {\n    var insertElem;\n\n    if (this.parent.enterKey === 'DIV' && !shiftKey || this.parent.shiftEnterKey === 'DIV' && shiftKey) {\n      insertElem = this.parent.createElement('div');\n    } else if (this.parent.enterKey === 'P' && !shiftKey || this.parent.shiftEnterKey === 'P' && shiftKey) {\n      insertElem = this.parent.createElement('p');\n    }\n\n    return insertElem;\n  };\n\n  return EnterKeyAction;\n}();\n\nexport { EnterKeyAction };","map":{"version":3,"sources":["/Users/altynbekkuat/Desktop/reactAnalyt/node_modules/@syncfusion/ej2-react-richtexteditor/node_modules/@syncfusion/ej2-richtexteditor/src/rich-text-editor/actions/enter-key.js"],"names":["isNullOrUndefined","isNOU","detach","events","EnterKeyAction","parent","addEventListener","prototype","on","enterHandler","destroy","removeEventListener","off","getRangeNode","range","getRange","startNode","startContainer","nodeName","parentElement","endNode","endContainer","e","_this","isTableEnter","closest","curElement","blockElement","formatter","editorManager","domNode","isBlockNode","tagName","args","which","code","shiftKey_1","shiftKey","actionBeginArgs","cancel","name","actionBegin","requestType","originalEvent","trigger","startOffset","endOffset","deleteContents","textContent","length","inputElement","enterKey","innerHTML","focusElem","childNodes","nodeSelection","setCursorPoint","contentModule","getDocument","previousSibling","currentFocusElem","lastChild","preventDefault","shiftEnterKey","nearBlockNode","blockParentNode","isImageNode","isFocusedFirst","startNodeText","splitFirstText","substring","charCodeAt","trim","isNearBlockLengthZero","newElem","createInsertElement","nodeCutter","SplitNode","cloneNode","insertElem","firstChild","appendChild","insertBefore","finalFocusElem","nextElementSibling","children","insertAfter","brElm","createElement","startParentElem","insertElm","currentParent","currentNode","previousNode","isEmptyBrInserted","currentParentLastChild","isLastNodeLength","focusBRElem","lineBreakBRElem","outerBRElem","insertFocusContent","nextSibling","insertBRElement","actionComplete","insertNode","brElm2"],"mappings":"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","sourcesContent":["import { isNullOrUndefined as isNOU, detach } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\n/**\n * `EnterKey` module is used to handle enter key press actions.\n */\nvar EnterKeyAction = /** @class */ (function () {\n    function EnterKeyAction(parent) {\n        this.parent = parent;\n        this.addEventListener();\n    }\n    EnterKeyAction.prototype.addEventListener = function () {\n        this.parent.on(events.enterHandler, this.enterHandler, this);\n        this.parent.on(events.destroy, this.destroy, this);\n    };\n    EnterKeyAction.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    EnterKeyAction.prototype.removeEventListener = function () {\n        this.parent.off(events.enterHandler, this.enterHandler);\n        this.parent.off(events.destroy, this.destroy);\n    };\n    EnterKeyAction.prototype.getRangeNode = function () {\n        this.range = this.parent.getRange();\n        this.startNode = this.range.startContainer.nodeName === '#text' ? this.range.startContainer.parentElement :\n            this.range.startContainer;\n        this.endNode = this.range.endContainer.nodeName === '#text' ? this.range.endContainer.parentElement :\n            this.range.endContainer;\n    };\n    EnterKeyAction.prototype.enterHandler = function (e) {\n        var _this = this;\n        this.getRangeNode();\n        var isTableEnter = true;\n        if (!isNOU(this.startNode.closest('TABLE')) && !isNOU(this.endNode.closest('TABLE'))) {\n            isTableEnter = false;\n            var curElement = this.startNode;\n            var blockElement = curElement;\n            while (!this.parent.formatter.editorManager.domNode.isBlockNode(curElement)) {\n                blockElement = curElement;\n                curElement = curElement.parentElement;\n            }\n            isTableEnter = blockElement.tagName === 'TD' ? false : true;\n        }\n        if (e.args.which === 13 && e.args.code === 'Enter') {\n            if (isNOU(this.startNode.closest('LI')) && isNOU(this.endNode.closest('LI')) && isTableEnter &&\n                isNOU(this.startNode.closest('PRE')) && isNOU(this.endNode.closest('PRE'))) {\n                var shiftKey_1 = e.args.shiftKey;\n                var actionBeginArgs = {\n                    cancel: false,\n                    name: events.actionBegin,\n                    requestType: shiftKey_1 ? 'ShiftEnterAction' : 'EnterAction',\n                    originalEvent: e.args\n                };\n                this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n                    if (!actionBeginArgs.cancel) {\n                        if (!(_this.range.startOffset === _this.range.endOffset && _this.range.startContainer === _this.range.endContainer)) {\n                            _this.range.deleteContents();\n                            if (_this.range.startContainer.nodeName === '#text' && _this.range.startContainer.textContent.length === 0 &&\n                                _this.range.startContainer.parentElement !== _this.parent.inputElement) {\n                                if (_this.parent.enterKey === 'BR') {\n                                    _this.range.startContainer.parentElement.innerHTML = '&#8203;';\n                                }\n                                else {\n                                    _this.range.startContainer.parentElement.innerHTML = '<br>';\n                                }\n                            }\n                            else if (_this.range.startContainer === _this.parent.inputElement && _this.range.startContainer.innerHTML === '') {\n                                _this.range.startContainer.innerHTML = '<br>';\n                                var focusElem = _this.range.startContainer.childNodes[_this.range.startOffset];\n                                _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), focusElem, 0);\n                            }\n                            else if (_this.parent.inputElement === _this.range.startContainer) {\n                                var focusElem = _this.range.startContainer.childNodes[_this.range.startOffset];\n                                if (focusElem.nodeName === '#text' && focusElem.textContent.length === 0) {\n                                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), focusElem, focusElem.previousSibling.textContent.length);\n                                }\n                                else {\n                                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), focusElem, focusElem.textContent.length >= 0 ? 0 : 1);\n                                    if (focusElem.previousSibling.textContent.length === 0) {\n                                        detach(focusElem.previousSibling);\n                                    }\n                                    else if (focusElem.textContent.length === 0) {\n                                        var currentFocusElem = focusElem.previousSibling.lastChild;\n                                        while (currentFocusElem.nodeName !== '#text') {\n                                            currentFocusElem = currentFocusElem.lastChild;\n                                        }\n                                        _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), currentFocusElem, currentFocusElem.textContent.length);\n                                        detach(focusElem);\n                                    }\n                                    else if (_this.parent.enterKey !== 'BR' &&\n                                        focusElem.previousSibling.textContent.length !== 0 && focusElem.textContent.length !== 0) {\n                                        e.args.preventDefault();\n                                        return;\n                                    }\n                                }\n                                _this.getRangeNode();\n                            }\n                        }\n                        if (_this.range.startContainer === _this.range.endContainer &&\n                            _this.range.startOffset === _this.range.endOffset && _this.range.startContainer === _this.parent.inputElement) {\n                            _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), _this.range.startContainer.childNodes[_this.range.startOffset], 0);\n                            _this.getRangeNode();\n                        }\n                        if ((_this.parent.enterKey === 'P' && !shiftKey_1) || (_this.parent.enterKey === 'DIV' && !shiftKey_1) ||\n                            (_this.parent.shiftEnterKey === 'P' && shiftKey_1) ||\n                            (_this.parent.shiftEnterKey === 'DIV' && shiftKey_1)) {\n                            var nearBlockNode = void 0;\n                            if (isTableEnter && _this.parent.formatter.editorManager.domNode.isBlockNode(_this.startNode)) {\n                                nearBlockNode = _this.startNode;\n                            }\n                            else {\n                                nearBlockNode = _this.parent.formatter.editorManager.domNode.blockParentNode(_this.startNode);\n                            }\n                            var isImageNode = false;\n                            var isFocusedFirst = false;\n                            if (_this.range.startOffset != 0 && _this.range.endOffset != 0 && _this.range.startContainer === _this.range.endContainer &&\n                                !(!isNOU(nearBlockNode.childNodes[0]) && nearBlockNode.childNodes[0].nodeName === 'IMG')) {\n                                var startNodeText = _this.range.startContainer.textContent;\n                                var splitFirstText = startNodeText.substring(0, _this.range.startOffset);\n                                if (splitFirstText.charCodeAt(_this.range.startOffset - 1) != 160 && splitFirstText.trim().length === 0) {\n                                    isFocusedFirst = true;\n                                }\n                            }\n                            else if (_this.range.startOffset === 0 && _this.range.endOffset === 0) {\n                                isFocusedFirst = true;\n                            }\n                            if (((_this.range.startOffset === 0 && _this.range.endOffset === 0) || isFocusedFirst) &&\n                                !(!isNOU(_this.range.startContainer.previousSibling) &&\n                                    (_this.range.startContainer.previousSibling.nodeName === 'IMG' || _this.range.startContainer.previousSibling.nodeName === 'BR'))) {\n                                var isNearBlockLengthZero = void 0;\n                                var newElem = void 0;\n                                if (_this.range.startContainer.nodeName === 'IMG') {\n                                    newElem = _this.createInsertElement(shiftKey_1);\n                                    isImageNode = true;\n                                    isNearBlockLengthZero = false;\n                                }\n                                else {\n                                    if (nearBlockNode.textContent.trim().length !== 0) {\n                                        newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, false).cloneNode(true);\n                                        isNearBlockLengthZero = false;\n                                    }\n                                    else {\n                                        newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, true).cloneNode(true);\n                                        isNearBlockLengthZero = true;\n                                    }\n                                }\n                                var insertElem = _this.createInsertElement(shiftKey_1);\n                                while (newElem.firstChild) {\n                                    insertElem.appendChild(newElem.firstChild);\n                                }\n                                nearBlockNode.parentElement.insertBefore(insertElem, nearBlockNode);\n                                if (!isNearBlockLengthZero) {\n                                    var currentFocusElem = insertElem;\n                                    var finalFocusElem = void 0;\n                                    while (!isNOU(currentFocusElem) && currentFocusElem.nodeName !== '#text') {\n                                        finalFocusElem = currentFocusElem;\n                                        currentFocusElem = currentFocusElem.lastChild;\n                                    }\n                                    finalFocusElem.innerHTML = '<br>';\n                                    if (!isImageNode) {\n                                        detach(nearBlockNode);\n                                    }\n                                }\n                                _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), insertElem.nextElementSibling, 0);\n                            }\n                            else if (nearBlockNode.textContent.length === 0 && !(!isNOU(nearBlockNode.childNodes[0]) && nearBlockNode.childNodes[0].nodeName === 'IMG')) {\n                                if (!isNOU(nearBlockNode.children[0]) && nearBlockNode.children[0].tagName !== 'BR') {\n                                    var newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, false).cloneNode(true);\n                                    _this.parent.formatter.editorManager.domNode.insertAfter(newElem, nearBlockNode);\n                                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), newElem, newElem.textContent.length >= 0 ? 0 : 1);\n                                }\n                                else {\n                                    var insertElem = _this.createInsertElement(shiftKey_1);\n                                    insertElem.innerHTML = '<br>';\n                                    _this.parent.formatter.editorManager.domNode.insertAfter(insertElem, nearBlockNode);\n                                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), insertElem, 0);\n                                }\n                            }\n                            else {\n                                var newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, nearBlockNode, true);\n                                if (!isNOU(newElem.childNodes[0]) && newElem.childNodes[0].nodeName === '#text' &&\n                                    newElem.childNodes[0].textContent.length === 0) {\n                                    detach(newElem.childNodes[0]);\n                                }\n                                if (newElem.textContent.trim().length === 0) {\n                                    var brElm = _this.parent.createElement('br');\n                                    if (_this.startNode.nodeName === 'A') {\n                                        var startParentElem = _this.startNode.parentElement;\n                                        _this.startNode.parentElement.insertBefore(brElm, _this.startNode);\n                                        detach(_this.startNode);\n                                        _this.startNode = startParentElem;\n                                    }\n                                    else {\n                                        _this.startNode.appendChild(brElm);\n                                    }\n                                    if (newElem.childNodes[0].textContent === '\\n') {\n                                        detach(newElem.childNodes[0]);\n                                    }\n                                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), _this.startNode, 0);\n                                }\n                                if (((_this.parent.enterKey === 'P' || _this.parent.enterKey === 'DIV') && !shiftKey_1) || ((_this.parent.shiftEnterKey === 'DIV' ||\n                                    _this.parent.shiftEnterKey === 'P') && shiftKey_1)) {\n                                    var insertElm = _this.createInsertElement(shiftKey_1);\n                                    while (newElem.firstChild) {\n                                        insertElm.appendChild(newElem.firstChild);\n                                    }\n                                    _this.parent.formatter.editorManager.domNode.insertAfter(insertElm, newElem);\n                                    detach(newElem);\n                                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), _this.parent.formatter.editorManager.domNode.isBlockNode(_this.startNode) ?\n                                        insertElm : _this.startNode, 0);\n                                }\n                            }\n                            e.args.preventDefault();\n                        }\n                        if ((_this.parent.enterKey === 'BR' && !shiftKey_1) || (_this.parent.shiftEnterKey === 'BR' && shiftKey_1)) {\n                            var currentParent = void 0;\n                            if (!_this.parent.formatter.editorManager.domNode.isBlockNode(_this.startNode)) {\n                                var currentNode = _this.startNode;\n                                var previousNode = currentNode;\n                                while (!_this.parent.formatter.editorManager.domNode.isBlockNode(currentNode)) {\n                                    previousNode = currentNode;\n                                    currentNode = currentNode.parentElement;\n                                }\n                                currentParent = currentNode === _this.parent.inputElement ?\n                                    previousNode : currentNode;\n                            }\n                            else {\n                                currentParent = _this.startNode;\n                            }\n                            var isEmptyBrInserted = false;\n                            var currentParentLastChild = currentParent.lastChild;\n                            while (!isNOU(currentParentLastChild) && !(currentParentLastChild.nodeName === '#text' || currentParentLastChild.nodeName === 'BR')) {\n                                currentParentLastChild = currentParentLastChild.lastChild;\n                            }\n                            var isLastNodeLength = _this.range.startContainer === currentParentLastChild ?\n                                _this.range.startContainer.textContent.length : currentParent.textContent.length;\n                            if (currentParent !== _this.parent.inputElement &&\n                                _this.parent.formatter.editorManager.domNode.isBlockNode(currentParent) &&\n                                _this.range.startOffset === _this.range.endOffset &&\n                                _this.range.startOffset === isLastNodeLength) {\n                                var focusBRElem = _this.parent.createElement('br');\n                                if (currentParentLastChild.nodeName === 'BR' && currentParent.textContent.length === 0) {\n                                    _this.parent.formatter.editorManager.domNode.insertAfter(focusBRElem, currentParentLastChild);\n                                }\n                                else {\n                                    var lineBreakBRElem = _this.parent.createElement('br');\n                                    _this.parent.formatter.editorManager.domNode.insertAfter(focusBRElem, _this.range.startContainer);\n                                    _this.parent.formatter.editorManager.domNode.insertAfter(lineBreakBRElem, _this.range.startContainer);\n                                }\n                                _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), focusBRElem, 0);\n                            }\n                            else if (!isNOU(currentParent) && currentParent !== _this.parent.inputElement && currentParent.nodeName !== 'BR') {\n                                if (currentParent.textContent.trim().length === 0 || (currentParent.textContent.trim().length === 1 &&\n                                    currentParent.textContent.charCodeAt(0) === 8203)) {\n                                    var newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, currentParent, true).cloneNode(true);\n                                    _this.parent.formatter.editorManager.domNode.insertAfter(newElem, currentParent);\n                                    var outerBRElem = _this.parent.createElement('br');\n                                    newElem.parentElement.insertBefore(outerBRElem, newElem);\n                                    _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), newElem, 0);\n                                }\n                                else {\n                                    var newElem = void 0;\n                                    var outerBRElem = _this.parent.createElement('br');\n                                    if (_this.range.startOffset === 0 && _this.range.endOffset === 0 &&\n                                        !isNOU(currentParent.previousSibling) && currentParent.previousSibling.nodeName === 'BR') {\n                                        newElem = _this.parent.formatter.editorManager.nodeCutter.SplitNode(_this.range, currentParent, false).cloneNode(true);\n                                        _this.parent.formatter.editorManager.domNode.insertAfter(outerBRElem, currentParent);\n                                        _this.insertFocusContent();\n                                        var currentFocusElem = outerBRElem.nextSibling;\n                                        while (!isNOU(currentFocusElem) && currentFocusElem.nodeName !== '#text') {\n                                            currentFocusElem = currentFocusElem.lastChild;\n                                        }\n                                        _this.parent.formatter.editorManager.nodeSelection.setCursorPoint(_this.parent.contentModule.getDocument(), currentFocusElem, 0);\n                                        isEmptyBrInserted = true;\n                                    }\n                                    else {\n                                        _this.insertBRElement();\n                                    }\n                                }\n                            }\n                            else {\n                                _this.insertBRElement();\n                            }\n                            e.args.preventDefault();\n                        }\n                        _this.parent.trigger(events.actionComplete, { requestType: shiftKey_1 ? 'ShiftEnterAction' : 'EnterAction', args: e.args });\n                    }\n                });\n            }\n        }\n    };\n    EnterKeyAction.prototype.insertBRElement = function () {\n        var isEmptyBrInserted = false;\n        var brElm = this.parent.createElement('br');\n        if (this.startNode.nodeName === 'BR' && this.endNode.nodeName === 'BR' && this.range.startOffset === 0 && this.range.startOffset === this.range.endOffset) {\n            this.parent.formatter.editorManager.domNode.insertAfter(brElm, this.startNode);\n            isEmptyBrInserted = true;\n        }\n        else {\n            if (this.startNode === this.parent.inputElement && !isNOU(this.range.startContainer.previousSibling) &&\n                this.range.startContainer.previousSibling.nodeName === 'BR' && this.range.startContainer.textContent.length === 0) {\n                isEmptyBrInserted = true;\n            }\n            this.range.insertNode(brElm);\n        }\n        if (isEmptyBrInserted || (!isNOU(brElm.nextElementSibling) && brElm.nextElementSibling.tagName === 'BR') || (!isNOU(brElm.nextSibling) && brElm.nextSibling.textContent.length > 0)) {\n            this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), !isNOU(brElm.nextSibling) ? brElm.nextSibling : brElm, 0);\n            isEmptyBrInserted = false;\n        }\n        else {\n            var brElm2 = this.parent.createElement('br');\n            this.range.insertNode(brElm2);\n            this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), brElm, 0);\n        }\n    };\n    EnterKeyAction.prototype.insertFocusContent = function () {\n        if (this.range.startContainer.textContent.length === 0) {\n            if (this.range.startContainer.nodeName === '#text') {\n                this.range.startContainer.parentElement.innerHTML = '&#8203;';\n            }\n            else {\n                this.range.startContainer.innerHTML = '&#8203;';\n            }\n        }\n    };\n    EnterKeyAction.prototype.createInsertElement = function (shiftKey) {\n        var insertElem;\n        if ((this.parent.enterKey === 'DIV' && !shiftKey) || (this.parent.shiftEnterKey === 'DIV' && shiftKey)) {\n            insertElem = this.parent.createElement('div');\n        }\n        else if ((this.parent.enterKey === 'P' && !shiftKey) || (this.parent.shiftEnterKey === 'P' && shiftKey)) {\n            insertElem = this.parent.createElement('p');\n        }\n        return insertElem;\n    };\n    return EnterKeyAction;\n}());\nexport { EnterKeyAction };\n"]},"metadata":{},"sourceType":"module"}